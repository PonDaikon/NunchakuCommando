(function(){const c=document.getElementById('products-grid');if(!c)return;const{badge}=NC.util;const sb=(s)=>`<span class="badge">${({released:'公開中','in-dev':'制作中',archive:'アーカイブ'})[s]||s}</span>`;const ti=(t)=>({game:'🎲',video:'▶️',flyer:'🖨️',event:'📅'}[t]||'📦');const act=(p)=>{const d=p.url||`/products/product.html?id=${encodeURIComponent(p.id)}`;const how=`${d}#howto`;let a=[];if(p.type==='game'){a.push(`<a class="btn" href="${how}">遊び方</a>`);if(p.sold===true){a.push('<span class="btn btn--sold" aria-disabled="true">SOLD</span>')}else if(p.shop){a.push(`<a class="btn btn--ghost" href="${p.shop}" target="_blank" rel="noopener">購入</a>`)}else{a.push('<span class="btn btn--sold" aria-disabled="true">COMING SOON</span>')}}else if(p.type==='video'){if(p.watch){a.push(`<a class="btn" href="${p.watch}" target="_blank" rel="noopener">視聴</a>`)}a.push(`<a class="btn btn--ghost" href="${d}">詳細</a>`)}else if(p.type==='event'){if(p.signup){a.push(`<a class="btn" href="${p.signup}" target="_blank" rel="noopener">申込/詳細</a>`)}a.push(`<a class="btn btn--ghost" href="${d}">イベント概要</a>`)}else{a.push(`<a class="btn" href="${d}">詳細</a>`);if(p.download){a.push(`<a class="btn btn--ghost" href="${p.download}" target="_blank" rel="noopener">資料DL</a>`)}}return`<div class="actions">${a.join('')}</div>`};const card=(p)=>{const cover=p.cover?`<img src="${p.cover}" alt="${p.title}のカバー画像" style="width:100%;height:auto;border-radius:12px;">`:'<div class="thumb">No Cover</div>';return`<article class="card">${cover}<h3 style="margin:8px 0 6px">${ti(p.type)} ${p.title}</h3><p class="muted" style="margin:0 0 6px">${p.subtitle||''}</p><div class="meta" style="margin:6px 0 10px">${(p.players?badge(p.players):'')+(p.time?badge(p.time):'')+(p.age?badge(p.age):'')} ${p.status?sb(p.status):''}</div>${act(p)}</article>`};const ph=()=>`<article class="card"><div class="thumb">Coming Soon</div><h3 style="margin:8px 0 6px">Coming Soon</h3><p class="muted" style="margin:0 0 6px">次のプロダクトを準備中です。</p><div class="actions"><span class="btn btn--sold" aria-disabled="true">詳細</span><span class="btn btn--sold" aria-disabled="true">COMING SOON</span></div></article>`;const ord=(s)=>({released:0,'in-dev':1,archive:2}[s]??9);fetch('products/products.json',{cache:'no-store'}).then(r=>r.json()).then(d=>{if(!Array.isArray(d.products))throw new Error('Invalid schema');const sorted=d.products.sort((a,b)=>(a.order??0)-(b.order??0)||ord(a.status)-ord(b.status));const desired=3;const cards=sorted.map(card);while(cards.length<desired){cards.push(ph())}c.innerHTML=cards.slice(0,desired).join('\n')}).catch(e=>{console.error(e);c.innerHTML='<p class="muted">プロダクトデータの読み込みに失敗しました。<a href="/products/">プロダクト一覧</a>をご覧ください。</p>'});})();